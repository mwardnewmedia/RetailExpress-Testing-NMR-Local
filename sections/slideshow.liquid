<div class="slideshow color-{{ section.settings.section_color_scheme }}">
  <script async src="https://unpkg.com/smoothscroll-polyfill@0.4.4/dist/smoothscroll.js"></script>

  <div class="mx-auto max-w-7xl px-6 text-center lg:px-8">
    {% if section.settings.gallery_heading != blank %}
      <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl text-left">
        {{ section.settings.gallery_heading }}
      </h2>
    {% endif %}
  </div>

  <div
    x-data="
      {
          skip: 1,
          atBeginning: false,
          atEnd: false,
          next() {
              this.to((current, offset) => current + (offset * this.skip))
          },
          prev() {
              this.to((current, offset) => current - (offset * this.skip))
          },
          to(strategy) {
              let slider = this.$refs.slider
              let current = slider.scrollLeft
              let offset = slider.firstElementChild.getBoundingClientRect().width
              slider.scrollTo({ left: strategy(current, offset), behavior: 'smooth' })
          },
          focusableWhenVisible: {
              'x-intersect:enter'() {
                  this.$el.removeAttribute('tabindex')
              },
              'x-intersect:leave'() {
                  this.$el.setAttribute('tabindex', '-1')
              },
          },
          disableNextAndPreviousButtons: {
              'x-intersect:enter.threshold.05'() {
                  let slideEls = this.$el.parentElement.children

                  // If this is the first slide.
                  if (slideEls[0] === this.$el) {
                      this.atBeginning = true
                  // If this is the last slide.
                  } else if (slideEls[slideEls.length-1] === this.$el) {
                      this.atEnd = true
                  }
              },
              'x-intersect:leave.threshold.05'() {
                  let slideEls = this.$el.parentElement.children

                  // If this is the first slide.
                  if (slideEls[0] === this.$el) {
                      this.atBeginning = false
                  // If this is the last slide.
                  } else if (slideEls[slideEls.length-1] === this.$el) {
                      this.atEnd = false
                  }
              },
          },
      }
    "
    class="flex w-full flex-col"
  >
    <div
      x-on:keydown.right="next"
      x-on:keydown.left="prev"
      tabindex="0"
      role="region"
      aria-labelledby="carousel-label"
      class="flex space-x-6"
    >
      <h2 id="carousel-label" class="sr-only" hidden>Carousel</h2>

      <span id="carousel-content-label" class="sr-only" hidden>Carousel</span>

      <ul
        x-ref="slider"
        tabindex="0"
        role="listbox"
        aria-labelledby="carousel-content-label"
        class="flex w-full snap-x snap-mandatory overflow-x-scroll"
      >
        {% for block in section.blocks %}
          <li
            x-bind="disableNextAndPreviousButtons"
            class="flex w-full shrink-0 snap-start flex-col items-center justify-center p-2 overflow-hidden{% if block.settings.image_dimensions == 'adaptive' %} h-56 sm:h-96 md:h-180{% endif %} mix relative"
            role="option"
          >
            <img
              src="{{ block.settings.image | image_url: width: 1920 }}"
              loading="lazy"
              class="{% if block.settings.image_dimensions == 'adaptive' %}absolute object-cover object-center h-full{% endif %} w-full"
              alt="{{ block.settings.image.alt }}"
            >
            <div class="slide-overlay absolute bg-black/{{ block.settings.image_overlay_opacity }} h-full w-full">
              <div class="flex items-center justify-center flex-col h-full">
                <h1 class="text-center text-white text-xl md:text-5xl font-bold mb-3 sm:mb-7">
                  {{ block.settings.heading }}
                </h1>
                <p class="text-white text-sm md:text-2xl mb-3 sm:mb-7">{{ block.settings.subheading }}</p>
                {% if block.settings.button_link %}
                <a
                  class="bg-cyan-500 hover:bg-cyan-700 text-white p-3 md:p-4 rounded inline-block text-sm md:text-xl"
                  href="{{ block.settings.button_link }}"
                >
                {% endif %}
                  {{ block.settings.button_label }}
                </a>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
    <div class="slideshow-controls flex align-center justify-center border-b py-2 space-x-3">
      <!-- Prev Button -->
      <button
        x-on:click="prev"
        class="text-6xl"
        :aria-disabled="atBeginning"
        :tabindex="atEnd ? -1 : 0"
        :class="{ 'opacity-50 cursor-not-allowed': atBeginning }"
      >
        <span aria-hidden="true">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 text-gray-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="3"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
        </span>
        <span class="sr-only">Skip to previous slide page</span>
      </button>

      <!-- Next Button -->
      <button
        x-on:click="next"
        class="text-6xl"
        :aria-disabled="atEnd"
        :tabindex="atEnd ? -1 : 0"
        :class="{ 'opacity-50 cursor-not-allowed': atEnd }"
      >
        <span aria-hidden="true">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 text-gray-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="3"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
          </svg>
        </span>
        <span class="sr-only">Skip to next slide page</span>
      </button>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "t:sections.slideshow.name",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Header"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "t:sections.slideshow.blocks.slide.name",
      "limit": 5,
      "settings": [
        {
          "type": "select",
          "id": "image_dimensions",
          "options": [
            {
              "value": "adaptive",
              "label": "Adaptive"
            },
            {
              "value": "actual",
              "label": "Actual"
            }
          ],
          "default": "adaptive",
          "label": "Image dimensions"
        },
        {
          "type": "color_scheme",
          "id": "section_color_scheme",
          "label": "t:sections.all.colors.label",
          "default": "background-1"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Slide image"
        },
        {
          "type": "inline_richtext",
          "id": "heading",
          "default": "Image slide",
          "label": "Slide heading"
        },
        {
          "type": "inline_richtext",
          "id": "subheading",
          "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam pellentesque varius leo, at aliquam magna dapibus vel.",
          "label": "Subheading"
        },
        {
          "type": "text",
          "id": "button_label",
          "default": "Button label",
          "label": "Button label"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button URL"
        },
        {
          "type": "range",
          "id": "image_overlay_opacity",
          "min": 0,
          "max": 100,
          "step": 10,
          "unit": "%",
          "label": "Image Overlay Opacity",
          "default": 0
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.slideshow.presets.name",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
